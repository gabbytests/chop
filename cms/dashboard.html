<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vendor Portal - Food Delivery</title>
  <style>
    :root {
      --primary-color: #ff5722;
      --text-color: #1d1d1f;
      --bg-color: #f5f5f7;
      --card-bg: #fff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --border-radius: 12px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      overflow-x: hidden;
    }
    .container {
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: var(--card-bg);
      padding: 15px;
      box-shadow: var(--shadow);
      position: fixed;
      height: 100%;
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    .sidebar h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-color);
    }
    .sidebar ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      height: calc(100% - 60px);
    }
    .sidebar ul li {
      margin-bottom: 10px;
    }
    .sidebar ul li a {
      text-decoration: none;
      color: var(--text-color);
      font-size: 14px;
      display: block;
      padding: 8px;
      border-radius: 6px;
      transition: background 0.3s;
    }
    .sidebar ul li a:hover,
    .sidebar ul li a.active {
      background: #f1f1f3;
      color: var(--primary-color);
    }
    .main-content {
      flex: 1;
      margin-left: 250px;
      padding: 10px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card-bg);
      padding: 10px 15px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 10px;
    }
    .header h1 {
      font-size: 18px;
      font-weight: 600;
    }
    .user-info {
      font-size: 12px;
      color: #666;
    }
    .user-info span {
      color: var(--primary-color);
      font-weight: 500;
    }
    .back-to-store {
      margin-bottom: 0px;
    }
    .back-to-store a {
      text-decoration: none;
      font-size: 16px;
      color: var(--primary-color);
      font-weight: 600;
      transition: color 0.3s ease;
    }
    .back-to-store a:hover {
      color: #e64a19;
    }
    .section {
      background: var(--card-bg);
      padding: 15px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      display: none;
    }
    .section.active {
      display: block;
    }
    .section h2 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .dashboard-section .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }
    .stat-card {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }
    .stat-card h3 {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    .stat-card p {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }
    .orders-section {
      margin-top: 20px;
    }
    .orders-section h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #333;
    }
    .order-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 400px;
      overflow-y: auto;
    }
    .full-order-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: calc(100vh - 120px);
      overflow-y: auto;
    }
    .order-item {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      transition: box-shadow 0.2s, transform 0.2s;
      cursor: pointer;
    }
    .order-item:hover {
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }
    .order-info {
      flex: 1;
      font-size: 14px;
      min-width: 0;
    }
    .order-info .order-id {
      font-weight: 500;
      color: #1d1d1f;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .order-info .order-date {
      color: #666;
      font-size: 12px;
    }
    .order-info .order-status {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      display: inline-block;
    }
    .order-status.pending {
      background: #ffd700;
      color: #333;
    }
    .order-status.completed {
      background: #4caf50;
      color: #fff;
    }
    .order-status.cancelled {
      background: #ff3b30;
      color: #fff;
    }
    .order-amount {
      font-weight: 600;
      color: var(--primary-color);
      margin-left: 10px;
    }
    .order-actions {
      margin-left: 10px;
    }
    .order-actions button {
      padding: 5px 10px;
      font-size: 12px;
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .order-actions button:hover {
      background: #388e3c;
    }
    #menu-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
    }
    #menu-form input[type="text"],
    #menu-form input[type="number"],
    #menu-form input[type="file"] {
      padding: 8px;
      border: 1px solid #d2d2d7;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    #menu-form input:focus {
      border-color: var(--primary-color);
      outline: none;
    }
    #menuImage {
      display: block;
    }
    #menuImage.hidden {
      display: none;
    }
    .button-group {
      display: flex;
      gap: 6px;
      justify-content: flex-end;
    }
    button {
      padding: 8px 15px;
      background: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
    }
    button:hover {
      background: #e64a19;
      transform: translateY(-1px);
    }
    button.secondary {
      background: #e0e0e0;
      color: var(--text-color);
    }
    button.secondary:hover {
      background: #d0d0d0;
    }
    .menu-list-title {
      font-size: 16px;
      font-weight: 600;
      margin: 10px 0 8px;
      color: #333;
    }
    #menuList {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .menu-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      transition: box-shadow 0.2s, transform 0.2s;
    }
    .menu-item:hover {
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }
    .menu-item img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #eee;
      margin-right: 10px;
    }
    .menu-info {
      flex: 1;
      font-size: 14px;
      min-width: 0;
    }
    .menu-info .name {
      font-weight: 500;
      color: #1d1d1f;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .menu-info .price {
      color: #666;
      font-size: 12px;
    }
    .actions {
      display: flex;
      gap: 5px;
      margin-left: 10px;
    }
    .actions button {
      padding: 5px 8px;
      font-size: 12px;
      border-radius: 4px;
    }
    .actions button:nth-child(2) {
      background: #ff3b30;
    }
    .actions button:nth-child(2):hover {
      background: #d32f2f;
    }
    #settings-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    #settings-form input {
      padding: 8px;
      border: 1px solid #d2d2d7;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    #settings-form input:focus {
      border-color: var(--primary-color);
      outline: none;
    }
    .settings-option {
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
    }
    .settings-option label {
      display: block;
      font-size: 14px;
      margin-bottom: 5px;
      color: #333;
    }
    .notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #4CAF50;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      font-size: 18px;
      font-weight: 600;
      color: #fff;
      display: none;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    .notification.error {
      background: #ff3b30;
      color: #fff;
    }
    .menu-toggle {
      display: none;
      color: #000;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }
    .modal-content h2 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    .modal-content .close-btn {
      float: right;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }
    .modal-content .close-btn:hover {
      color: #333;
    }
    .order-details {
      font-size: 16px;
      line-height: 1.8;
    }
    .order-details strong {
      color: #333;
    }
    .order-details .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-top: 15px;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    .order-details ul {
      list-style: none;
      margin-left: 10px;
    }
    .order-details ul li {
      margin-bottom: 8px;
    }
    @media screen and (max-width: 750px) {
      .sidebar {
        transform: translateX(-100%);
        width: 200px;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
        padding: 8px;
      }
      .header {
        padding: 8px 10px;
      }
      .header h1 {
        font-size: 16px;
      }
      .menu-toggle {
        display: block;
      }
      .section {
        padding: 10px;
      }
      #menu-form,
      #settings-form {
        padding: 8px;
      }
      #menuList {
        gap: 5px;
      }
      .menu-item {
        flex-direction: row;
        align-items: center;
        padding: 8px;
        gap: 5px;
      }
      .menu-item img {
        width: 40px;
        height: 40px;
        margin-right: 8px;
      }
      .menu-info {
        flex: 1;
        font-size: 12px;
      }
      .menu-info .name {
        font-size: 12px;
      }
      .menu-info .price {
        font-size: 10px;
      }
      .actions {
        margin-left: 8px;
        gap: 4px;
      }
      .actions button {
        padding: 4px 6px;
        font-size: 10px;
        min-width: 50px;
      }
      .button-group {
        flex-direction: row;
        justify-content: space-between;
      }
      .dashboard-section .stats {
        grid-template-columns: 1fr;
      }
      .settings-option {
        padding: 8px;
      }
      .notification {
        font-size: 16px;
        padding: 15px 20px;
      }
      .order-item {
        padding: 8px;
      }
      .order-info {
        font-size: 12px;
      }
      .order-info .order-date,
      .order-info .order-status {
        font-size: 10px;
      }
      .order-amount {
        font-size: 12px;
      }
      .modal-content {
        width: 95%;
        padding: 15px;
      }
      .modal-content h2 {
        font-size: 20px;
      }
      .order-details {
        font-size: 14px;
      }
      .order-details .section-title {
        font-size: 16px;
      }
      .full-order-list {
        height: calc(100vh - 100px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav class="sidebar">
      <h2>Vendor Portal</h2>
      <ul style="display: flex; flex-direction: column; height: calc(100% - 60px);">
        <li><a href="#" class="active" data-section="dashboard-section">Dashboard</a></li>
        <li><a href="#" data-section="orders-section">Orders</a></li>
        <li><a href="#" data-section="menu-section">Menu Items</a></li>
        <li><a href="#" data-section="settings-section">Settings</a></li>
        <li style="margin-top: auto;"><a href="#" onclick="logout()">Logout</a></li>
      </ul>
    </nav>

    <div class="main-content">
      <div class="header">
        <button class="menu-toggle">☰</button>
        <h1 id="header-title">Dashboard</h1>
        <div class="back-to-store">
          <a href="../index.html">← Back to Store</a>
        </div>
      </div>

      <div class="section dashboard-section active" id="dashboard-section">
        <h2>Welcome, Vendor</h2>
        <p>Here’s a quick overview of your restaurant.</p>
        <div class="stats">
          <div class="stat-card">
            <h3>Total Menu Items</h3>
            <p id="total-menu-items">0</p>
          </div>
          <div class="stat-card">
            <h3>Total Orders</h3>
            <p id="total-orders">0</p>
          </div>
        </div>
        <div class="orders-section">
          <h3>Recent Orders</h3>
          <div id="orderList" class="order-list"></div>
        </div>
      </div>

      <div class="section orders-section" id="orders-section">
        <h2>All Orders</h2>
        <div id="fullOrderList" class="full-order-list"></div>
      </div>

      <div class="section menu-section" id="menu-section">
        <h2>Manage Menu Items</h2>
        <form id="menu-form">
          <input type="hidden" id="menuId">
          <input type="text" id="menuName" placeholder="Item Name" required>
          <input type="number" id="menuPrice" placeholder="Price" step="0.01" required>
          <input type="file" id="menuImage" accept="image/*" onchange="updatePreview()">
          <div class="button-group">
            <button type="submit">Save Item</button>
            <button type="button" class="secondary" onclick="clearForm()">Clear</button>
          </div>
        </form>
        <div class="menu-list-title">Menu List</div>
        <div id="menuList"></div>
      </div>

      <div class="section settings-section" id="settings-section">
        <h2>Settings</h2>
        <form id="settings-form">
          <div class="settings-option">
            <label for="currentPassword">Current Password</label>
            <input type="password" id="currentPassword" placeholder="Enter current password" required>
          </div>
          <div class="settings-option">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" placeholder="Enter new password" required>
          </div>
          <div class="settings-option">
            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
          </div>
          <div class="button-group">
            <button type="submit">Update Password</button>
          </div>
        </form>
      </div>
    </div>

    <div class="notification" id="notification"></div>
    <div class="modal" id="orderModal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeOrderModal()">×</span>
        <div id="orderDetails"></div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
   const firebaseConfig = {
  apiKey: "AIzaSyADvpUQWo75ExePGoCRirD2mM-lmfM4Cmc",
  authDomain: "von600-7982d.firebaseapp.com",
  projectId: "von600-7982d",
  storageBucket: "von600-7982d.firebasestorage.app",
  messagingSenderId: "164591218045",
  appId: "1:164591218045:web:afe17512e16573e7903014",
  measurementId: "G-E69DMPLXBK"
};
    try {
      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization failed:", error);
      showNotification("Failed to connect to database", true);
    }

    const db = firebase.firestore();
    const menuRef = firebase.database().ref('menu');
    let menuCache = null;

    function loadMenu() {
      if (menuCache) {
        displayMenu(menuCache);
        return;
      }
      menuRef.once('value', (snapshot) => {
        menuCache = snapshot.val() || {};
        localStorage.setItem("menu", JSON.stringify(menuCache));
        displayMenu(menuCache);
      }, (error) => {
        console.error("Error loading menu:", error);
        showNotification("Failed to load menu items", true);
      });
    }

    function displayMenu(menu) {
      const menuList = document.getElementById("menuList");
      menuList.innerHTML = "";
      if (!menu || Object.keys(menu).length === 0) {
        menuList.innerHTML = "<p>No menu items available.</p>";
        return;
      }
      Object.entries(menu).forEach(([id, item]) => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <img src="${item.image || ''}" alt="${item.name}">
          <div class="menu-info">
            <div class="name">${item.name}</div>
            <div class="price">$${item.price.toFixed(2)}</div>
          </div>
          <div class="actions">
            <button onclick="editMenuItem('${id}')">Edit</button>
            <button onclick="deleteMenuItem('${id}')">Delete</button>
          </div>
        `;
        menuList.appendChild(div);
      });
    }

    function updatePreview() {
      const fileInput = document.getElementById('menuImage');
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          saveMenuItem(null, document.getElementById('menuName').value, parseFloat(document.getElementById('menuPrice').value), e.target.result);
        };
        reader.readAsDataURL(file);
      }
    }

    document.getElementById('menu-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('menuId').value;
      const name = document.getElementById('menuName').value;
      const price = parseFloat(document.getElementById('menuPrice').value);
      const fileInput = document.getElementById('menuImage');
      const file = fileInput.files[0];

      if (id) {
        menuRef.child(id).once('value', (snapshot) => {
          const existingItem = snapshot.val();
          const image = file ? null : (existingItem.image || null);
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              saveMenuItem(id, name, price, e.target.result);
            };
            reader.readAsDataURL(file);
          } else {
            saveMenuItem(id, name, price, image);
          }
        }).catch(error => {
          console.error("Error fetching item for edit:", error);
          showNotification('Error editing item: ' + error.message, true);
        });
      } else if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          saveMenuItem(null, name, price, e.target.result);
        };
        reader.readAsDataURL(file);
      } else {
        saveMenuItem(null, name, price, null);
      }
    });

    function saveMenuItem(id, name, price, image) {
      const itemData = { name, price };
      if (image) itemData.image = image;

      const ref = id ? menuRef.child(id) : menuRef.push();
      ref.set(itemData)
        .then(() => {
          menuCache = null;
          showNotification(id ? 'Item Updated' : 'Item Added');
          clearForm();
          loadMenu();
        })
        .catch(error => {
          console.error("Error saving item:", error);
          showNotification('Error saving item: ' + error.message, true);
        });
    }

    function editMenuItem(id) {
      menuRef.child(id).once('value', (snapshot) => {
        const item = snapshot.val();
        document.getElementById('menuId').value = id;
        document.getElementById('menuName').value = item.name;
        document.getElementById('menuPrice').value = item.price;
        document.getElementById('menuImage').classList.add('hidden');
      });
    }

    function deleteMenuItem(id) {
      if (confirm('Are you sure you want to delete this menu item?')) {
        menuRef.child(id).remove()
          .then(() => {
            menuCache = null;
            showNotification('Item Deleted');
            loadMenu();
          })
          .catch(error => showNotification('Error deleting item', true));
      }
    }

    function clearForm() {
      document.getElementById('menu-form').reset();
      document.getElementById('menuId').value = '';
      document.getElementById('menuImage').classList.remove('hidden');
    }

    function markOrderCompleted(orderId) {
      db.collection('orders').doc(orderId).update({
        status: 'Completed'
      })
      .then(() => {
        showNotification('Order marked as Completed');
      })
      .catch(error => {
        console.error("Error updating order status:", error);
        showNotification('Error marking order as Completed', true);
      });
    }

    function showOrderDetails(order) {
      const modal = document.getElementById('orderModal');
      const orderDetails = document.getElementById('orderDetails');
      const date = order.timestamp ? new Date(order.timestamp.toMillis()).toLocaleString() : 'N/A';

      orderDetails.innerHTML = `
        <h2>Order #${order.orderNumber}</h2>
        <div class="order-details">
          <p><strong>Status:</strong> <span class="order-status ${order.status ? order.status.toLowerCase() : 'pending'}">${order.status || 'Pending'}</span></p>
          <p><strong>Date:</strong> ${date}</p>
          <p><strong>Total:</strong> $${order.total.toFixed(2)}</p>
          <div class="section-title">Delivery Information</div>
          <p><strong>Name:</strong> ${order.billing.fullName}</p>
          <p><strong>Address:</strong> ${order.billing.address}${order.billing.address2 ? ', ' + order.billing.address2 : ''}</p>
          <p><strong>City:</strong> ${order.billing.city}</p>
          <p><strong>ZIP:</strong> ${order.billing.zip || 'N/A'}</p>
          <div class="section-title">Items</div>
          <ul>
            ${order.cart.map(item => `<li>${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)}</li>`).join('')}
          </ul>
        </div>
      `;
      modal.style.display = 'flex';
    }

    function closeOrderModal() {
      const modal = document.getElementById('orderModal');
      modal.style.display = 'none';
    }

    function loadOrders() {
      const orderList = document.getElementById('orderList');
      db.collection('orders').orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
        orderList.innerHTML = '';
        const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (orders.length === 0) {
          orderList.innerHTML = '<p>No orders available.</p>';
          return;
        }
        orders.forEach(order => {
          const div = document.createElement('div');
          div.className = 'order-item';
          const date = order.timestamp ? new Date(order.timestamp.toMillis()).toLocaleString() : 'N/A';
          const statusClass = order.status ? order.status.toLowerCase() : 'pending';

          const deliveryInfo = `
            <strong>Delivery:</strong> ${order.billing.fullName}, ${order.billing.address}, ${order.billing.city}
          `;
          const cartItems = order.cart.map(item => `${item.name} x${item.quantity} ($${item.price.toFixed(2)})`).join(', ');

          div.innerHTML = `
            <div class="order-info">
              <div class="order-id">Order #${order.orderNumber}</div>
              <div class="order-date">${date}</div>
              <div class="order-status ${statusClass}">${order.status || 'Pending'}</div>
              <div class="order-billing">${deliveryInfo}</div>
              <div class="order-cart"><strong>Items:</strong> ${cartItems}</div>
            </div>
            <div class="order-amount">$${order.total.toFixed(2)}</div>
            <div class="order-actions">
              ${order.status !== 'Completed' ? `<button onclick="markOrderCompleted('${order.id}'); event.stopPropagation();">Mark Completed</button>` : ''}
            </div>
          `;
          div.addEventListener('click', () => showOrderDetails(order));
          orderList.appendChild(div);
        });
        document.getElementById('total-orders').textContent = orders.length;
      }, (error) => {
        console.error("Error loading orders:", error);
        showNotification("Failed to load orders", true);
      });
    }

    function loadAllOrders() {
      const fullOrderList = document.getElementById('fullOrderList');
      db.collection('orders').orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
        fullOrderList.innerHTML = '';
        const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (orders.length === 0) {
          fullOrderList.innerHTML = '<p>No orders available.</p>';
          return;
        }
        orders.forEach(order => {
          const div = document.createElement('div');
          div.className = 'order-item';
          const date = order.timestamp ? new Date(order.timestamp.toMillis()).toLocaleString() : 'N/A';
          const statusClass = order.status ? order.status.toLowerCase() : 'pending';

          const deliveryInfo = `
            <strong>Delivery:</strong> ${order.billing.fullName}, ${order.billing.address}, ${order.billing.city}
          `;
          const cartItems = order.cart.map(item => `${item.name} x${item.quantity} ($${item.price.toFixed(2)})`).join(', ');

          div.innerHTML = `
            <div class="order-info">
              <div class="order-id">Order #${order.orderNumber}</div>
              <div class="order-date">${date}</div>
              <div class="order-status ${statusClass}">${order.status || 'Pending'}</div>
              <div class="order-billing">${deliveryInfo}</div>
              <div class="order-cart"><strong>Items:</strong> ${cartItems}</div>
            </div>
            <div class="order-amount">$${order.total.toFixed(2)}</div>
            <div class="order-actions">
              ${order.status !== 'Completed' ? `<button onclick="markOrderCompleted('${order.id}'); event.stopPropagation();">Mark Completed</button>` : ''}
            </div>
          `;
          div.addEventListener('click', () => showOrderDetails(order));
          fullOrderList.appendChild(div);
        });
      }, (error) => {
        console.error("Error loading all orders:", error);
        showNotification("Failed to load orders", true);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (!localStorage.getItem('authenticated')) {
        window.location.href = 'login.html';
        return;
      }

      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
      });

      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 750 && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
          sidebar.classList.remove('active');
        }
      });

      const modal = document.getElementById('orderModal');
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeOrderModal();
        }
      });

      const navLinks = document.querySelectorAll('.sidebar ul li a');
      const sections = document.querySelectorAll('.section');
      const headerTitle = document.getElementById('header-title');
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const sectionId = link.getAttribute('data-section');
          if (!sectionId && link.textContent.trim() === 'Logout') {
            logout();
            return;
          }

          navLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');

          sections.forEach(section => section.classList.remove('active'));
          const targetSection = document.getElementById(sectionId);
          if (targetSection) {
            targetSection.classList.add('active');
            headerTitle.textContent = link.textContent.trim();
          }

          if (sectionId === 'menu-section') {
            loadMenu();
          } else if (sectionId === 'dashboard-section') {
            updateDashboardStats();
          } else if (sectionId === 'orders-section') {
            loadAllOrders();
          }

          if (window.innerWidth <= 750) {
            sidebar.classList.remove('active');
          }
        });
      });

      function logout() {
        localStorage.removeItem("authenticated");
        window.location.href = "login.html";
      }

      function updateDashboardStats() {
        const totalMenuItems = document.getElementById('total-menu-items');
        firebase.database().ref('menu').once('value', (snapshot) => {
          totalMenuItems.textContent = snapshot.numChildren() || 0;
        }, (error) => {
          console.error("Error fetching menu count:", error);
          showNotification("Failed to load menu count", true);
        });
        loadOrders();
      }

      const settingsForm = document.getElementById('settings-form');
      const passwordRef = firebase.database().ref('settings/password');
      settingsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        passwordRef.once('value', (snapshot) => {
          const storedPassword = snapshot.val() || 'vendor123';
          if (currentPassword !== storedPassword) {
            showNotification('Current password is incorrect', true);
          } else if (newPassword !== confirmPassword) {
            showNotification('New passwords do not match', true);
          } else {
            passwordRef.set(newPassword)
              .then(() => {
                showNotification('Password updated successfully');
                settingsForm.reset();
              })
              .catch(error => {
                console.error("Error updating password:", error);
                showNotification('Error updating password: ' + error.message, true);
              });
          }
        }, (error) => {
          console.error("Error fetching password:", error);
          showNotification("Failed to load current password", true);
        });
      });

      function showNotification(message, isError = false) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.toggle('error', isError);
        notification.style.display = 'block';
        notification.style.opacity = '1';
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => notification.style.display = 'none', 500);
        }, 3000);
      }

      updateDashboardStats();
    });

    document.querySelector('[data-section="menu-section"]').addEventListener('click', loadMenu);
  </script>
</body>
</html>